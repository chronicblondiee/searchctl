input {
  beats {
    port => "${BEATS_PORT:5044}"
  }
}

filter {
  json {
    source => "message"
  }

  date {
    match => ["@timestamp", "ISO8601", "yyyy-MM-dd'T'HH:mm:ss.SSSZZ"]
    target => "@timestamp"
    timezone => "UTC"
  }

  mutate {
    lowercase => ["level"]
    rename => { "host" => "host.name" }
  }
}

output {
  elasticsearch {
    hosts => [ "${ES_HOSTS:https://localhost:9200}" ]
    user => "${ES_USERNAME:elastic}"
    password => "${ES_PASSWORD:changeme}"
    data_stream => true
    data_stream_type => "logs"
    data_stream_dataset => "app.json"
    data_stream_namespace => "${DATA_STREAM_NAMESPACE:default}"
    ilm_enabled => false
  }
}
